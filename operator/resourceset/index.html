
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Flux Operator API for generating FluxCD resources">
      
      
        <meta name="author" content="ControlPLane">
      
      
        <link rel="canonical" href="https://fluxcd.control-plane.io/operator/resourceset/">
      
      
        <link rel="prev" href="../fluxreport/">
      
      
        <link rel="next" href="../resourcesetinputprovider/">
      
      
      <link rel="icon" href="../../images/logo/enterprise-for-flux-cd-icon-colour.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ResourceSet CRD - ControlPlane Enterprise for Flux CD</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="ResourceSet CRD - ControlPlane Enterprise for Flux CD" >
      
        <meta  property="og:description"  content="Flux Operator API for generating FluxCD resources" >
      
        <meta  property="og:image"  content="https://fluxcd.control-plane.io/assets/images/social/operator/resourceset.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://fluxcd.control-plane.io/operator/resourceset/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="ResourceSet CRD - ControlPlane Enterprise for Flux CD" >
      
        <meta  name="twitter:description"  content="Flux Operator API for generating FluxCD resources" >
      
        <meta  name="twitter:image"  content="https://fluxcd.control-plane.io/assets/images/social/operator/resourceset.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#resourceset-crd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ControlPlane Enterprise for Flux CD" class="md-header__button md-logo" aria-label="ControlPlane Enterprise for Flux CD" data-md-component="logo">
      
  <img src="../../images/logo/enterprise-for-flux-cd-icon-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ControlPlane Enterprise for Flux CD
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ResourceSet CRD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/controlplaneio-fluxcd/distribution" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    distribution
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../distribution/" class="md-tabs__link">
          
  
  
  Flux Distribution

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Flux Operator

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mcp/" class="md-tabs__link">
          
  
  
  Flux MCP Server

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../pricing/" class="md-tabs__link">
        
  
  
    
  
  Pricing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://control-plane.io/contact/?inquiry=fluxcd" class="md-tabs__link">
        
  
  
    
  
  Contact

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ControlPlane Enterprise for Flux CD" class="md-nav__button md-logo" aria-label="ControlPlane Enterprise for Flux CD" data-md-component="logo">
      
  <img src="../../images/logo/enterprise-for-flux-cd-icon-white.png" alt="logo">

    </a>
    ControlPlane Enterprise for Flux CD
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/controlplaneio-fluxcd/distribution" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    distribution
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flux Distribution
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Flux Distribution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distribution/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distribution/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../distribution/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/flux-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/d1-architecture-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    D1 Reference Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/d2-architecture-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    D2 Reference Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/flux-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Multitenant Policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/flux-generic-helm-chart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generic Helm Chart Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/flux-cli-quick-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux CLI Quick Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Marketplaces
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Marketplaces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../marketplace/aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Marketplace
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Versions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Versions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releases/release-v2.2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release v2.2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Flux Operator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Flux Operator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Instance Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Instance Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux-config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Controllers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux-sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Cluster Sync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux-kustomize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Customization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux-sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Sharding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flux Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flux-bootstrap-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bootstrap Migration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    ResourceSet Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            ResourceSet Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/app-definition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/time-based-delivery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time-based App Delivery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/image-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Update Automation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5" >
        
          
          <label class="md-nav__link" for="__nav_3_4_5" id="__nav_3_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Self-Service Environments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5">
            <span class="md-nav__icon md-icon"></span>
            Self-Service Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/github-pull-requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ephemeral Environments for GitHub Pull Requests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesets/gitlab-merge-requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ephemeral Environments for GitLab Merge Requests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fluxinstance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FluxInstance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fluxreport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FluxReport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ResourceSet
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ResourceSet
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-resourceset-spec" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a ResourceSet spec
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing a ResourceSet spec">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inputs-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Input strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resources configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#templating-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Templating functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      Resource deduplication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copying-data-from-existing-configmaps-and-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Copying data from existing ConfigMaps and Secrets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-resource-exclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional resource exclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-input-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in input fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources-template" class="md-nav__link">
    <span class="md-ellipsis">
      Resources template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Common metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cel-readiness-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      CEL readiness expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconciliation-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciliation configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-check-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Health check configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role-based access control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garbage-collection" class="md-nav__link">
    <span class="md-ellipsis">
      Garbage collection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resourceset-status" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceSet Status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceSet Status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconciling-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciling ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Ready ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failed-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Failed ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stalled-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Stalled ResourceSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    <span class="md-ellipsis">
      History
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inventory" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resourceset-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceSet Metrics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resourcesetinputprovider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ResourceSetInputProvider
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Flux MCP Server
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Flux MCP Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/prompt-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompt Engineering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/instructions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AI Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/config-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Config API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MCP Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mcp/prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MCP Prompts
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pricing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pricing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://control-plane.io/contact/?inquiry=fluxcd" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contact
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-resourceset-spec" class="md-nav__link">
    <span class="md-ellipsis">
      Writing a ResourceSet spec
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing a ResourceSet spec">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inputs-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Input strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resources configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#templating-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Templating functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      Resource deduplication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copying-data-from-existing-configmaps-and-secrets" class="md-nav__link">
    <span class="md-ellipsis">
      Copying data from existing ConfigMaps and Secrets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-resource-exclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional resource exclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-input-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Built-in input fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources-template" class="md-nav__link">
    <span class="md-ellipsis">
      Resources template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Common metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependency-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cel-readiness-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      CEL readiness expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconciliation-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciliation configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#health-check-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Health check configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role-based access control
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#garbage-collection" class="md-nav__link">
    <span class="md-ellipsis">
      Garbage collection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resourceset-status" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceSet Status
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ResourceSet Status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconciling-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciling ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ready-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Ready ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failed-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Failed ResourceSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stalled-resourceset" class="md-nav__link">
    <span class="md-ellipsis">
      Stalled ResourceSet
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    <span class="md-ellipsis">
      History
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inventory" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resourceset-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceSet Metrics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="resourceset-crd">ResourceSet CRD</h1>
<p><strong>ResourceSet</strong> is a declarative API for generating a group of Kubernetes objects
based on a matrix of input values and a set of templated resources.</p>
<h2 id="example">Example</h2>
<p>The following example shows a ResourceSet that generates an application instance consisting of a
Flux HelmRelease and OCIRepository for each tenant with a specific version and replica count.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluxcd.controlplane.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">fluxcd.controlplane.io/reconcile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enabled&quot;</span>
<span class="w">    </span><span class="nt">fluxcd.controlplane.io/reconcileEvery</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30m&quot;</span>
<span class="w">    </span><span class="nt">fluxcd.controlplane.io/reconcileTimeout</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5m&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">commonMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span>
<span class="w">       </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6.7.x&quot;</span>
<span class="w">       </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team2&quot;</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span>
<span class="w">       </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6.6.x&quot;</span>
<span class="w">       </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oci://ghcr.io/stefanprodan/charts/podinfo</span>
<span class="w">        </span><span class="nt">ref</span><span class="p">:</span>
<span class="w">          </span><span class="nt">semver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.app.version | quote &gt;&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm.toolkit.fluxcd.io/v2</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HelmRelease</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1h</span>
<span class="w">        </span><span class="nt">releaseName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">chartRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">values</span><span class="p">:</span>
<span class="w">          </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.app.replicas | int &gt;&gt;</span>
</code></pre></div>
<p>You can run this example by saving the manifest into <code>podinfo.yaml</code>.</p>
<p><strong>1.</strong> Apply the ResourceSet on the cluster:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>podinfo.yaml
</code></pre></div>
<p><strong>2.</strong> Wait for the ResourceSet to reconcile the generated resources:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>resourceset/podinfo<span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>--timeout<span class="o">=</span>5m
</code></pre></div>
<p><strong>3.</strong> Run <code>kubectl get resourceset</code> to see the status of the resource:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>resourceset
<span class="go">NAME      AGE   READY   STATUS</span>
<span class="go">podinfo   59s   True    Reconciliation finished in 52s</span>
</code></pre></div>
<p><strong>4.</strong> Run <code>kubectl describe resourceset</code> to see the reconciliation status conditions and events:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>resourceset<span class="w"> </span>podinfo
<span class="go">Status:</span>
<span class="go">  Conditions:</span>
<span class="go">    Last Transition Time:  2024-09-24T09:58:53Z</span>
<span class="go">    Message:               Reconciliation finished in 52s</span>
<span class="go">    Observed Generation:   1</span>
<span class="go">    Reason:                ReconciliationSucceeded</span>
<span class="go">    Status:                True</span>
<span class="go">    Type:                  Ready</span>
<span class="go">Events:</span>
<span class="go">  Type    Reason          Age   From           Message</span>
<span class="go">  ----    ------          ----  ----           -------</span>
<span class="go">  Normal  ApplySucceeded  72s   flux-operator  HelmRelease/default/podinfo-team1 created</span>
<span class="go">                                               HelmRelease/default/podinfo-team2 created</span>
<span class="go">                                               OCIRepository/default/podinfo-team1 created</span>
<span class="go">                                               OCIRepository/default/podinfo-team2 created</span>
<span class="go">  Normal  ReconciliationSucceeded  72s  flux-operator  Reconciliation finished in 52s</span>
</code></pre></div>
<p><strong>5.</strong> Run <code>kubectl events</code> to see the events generated by the flux-operator:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>events<span class="w"> </span>--for<span class="w"> </span>resourceset/podinfo
</code></pre></div>
<p><strong>6.</strong> Run <code>kubectl delete</code> to remove the ResourceSet and its generated resources:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>resourceset<span class="w"> </span>podinfo
</code></pre></div>
<h2 id="writing-a-resourceset-spec">Writing a ResourceSet spec</h2>
<p>As with all other Kubernetes config, a ResourceSet needs <code>apiVersion</code>,
<code>kind</code>, <code>metadata.name</code> and <code>metadata.namespace</code> fields.
The name of a ResourceSet object must be a valid <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names#dns-subdomain-names">DNS subdomain name</a>.
A ResourceSet also needs a <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status"><code>.spec</code> section</a>.</p>
<h3 id="inputs-configuration">Inputs configuration</h3>
<p>The <code>.spec.inputs</code> field is optional and specifies a list of input values
to be used in the resources templates.</p>
<p>An input value is a key-value pair of strings and structs, where the key is the input name
which can be referenced in the resource templates using the <code>&lt;&lt; inputs.name &gt;&gt;</code> syntax.</p>
<p>Example of static inputs:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team1</span>
<span class="w">     </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team2</span>
<span class="w">     </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">privileged</span>
</code></pre></div>
<p>The <code>.spec.inputsFrom</code> field is optional and specifies a list of
<a href="../resourcesetinputprovider/">ResourceSetInputProvider</a>
references to objects that provide input values to the ResourceSet.
It has the following subfields (exactly one of them must be set):</p>
<ul>
<li><code>apiVersion</code>: The API version of the referenced object. Must be
  <code>fluxcd.controlplane.io/v1</code>. Optional.</li>
<li><code>kind</code>: The kind of the referenced object. Must be
  <code>ResourceSetInputProvider</code>. Optional.</li>
<li><code>.name</code>: The name of a <code>ResourceSetInputProvider</code> object in the same namespace
  as the <code>ResourceSet</code>. Optional.</li>
<li><code>.selector</code>: A label selector to select multiple <code>ResourceSetInputProvider</code>
  objects in the same namespace as the <code>ResourceSet</code>. Optional.</li>
</ul>
<p>Example of inputs generated from GitHub Pull Requests:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputsFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluxcd.controlplane.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSetInputProvider</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-pull-requests</span>
</code></pre></div>
<p>Example of inputs generated from multiple <code>ResourceSetInputProvider</code> objects via
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">Label Selectors</a>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputsFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluxcd.controlplane.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSetInputProvider</span>
<span class="w">      </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
<span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<span class="w">            </span><span class="nt">values</span><span class="p">:</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</code></pre></div>
<p>At runtime, the operator will fetch the input values every time the <code>ResourceSetInputProvider</code>
reconciler detects a change in the upstream source.</p>
<p>When both <code>.spec.inputs</code> and <code>.spec.inputsFrom</code> are set, the resulting inputs are the
flattened concatenation of the <code>.spec.inputs</code> input sets with the input sets from each
selected <code>ResourceSetInputProvider</code> object.</p>
<h4 id="input-strategy">Input strategy</h4>
<p>By default, the resulting inputs are the flattened concatenation of the <code>.spec.inputs</code> input sets
with the input sets from each selected <code>ResourceSetInputProvider</code> object. The <code>.spec.inputStrategy</code>
field can be set to change this default behavior.</p>
<p>The <code>.spec.inputStrategy</code> field has the following subfields:</p>
<ul>
<li><code>.name</code>: The name of the input strategy. If <code>.spec.inputStrategy</code> is not set, the behavior
  matches setting <code>.spec.inputStrategy.name</code> to <code>Flatten</code>. Supported values are <code>Flatten</code> and
  <code>Permute</code>.</li>
</ul>
<p>When <code>.spec.inputStrategy.name</code> is set to <code>Permute</code>, the resulting inputs are the Cartesian product
of the input sets from each selected <code>ResourceSetInputProvider</code> object, and from the <code>ResourceSet</code>
object itself if <code>.spec.inputs</code> is set. Therefore, the total amount of permutations, i.e. input sets,
is the product of the number of input sets from each source, i.e. <code>A_1 x A_2 x ... x A_n</code>, where <code>A_i</code>
is the number of input sets from the <code>i</code>-th source.</p>
<p><strong>Note</strong>: The combinatorial explosion of the <code>Permute</code> strategy can lead to a very large
number of permutations and can impact the performance of the operator. It is recommended
to use this strategy together with <code>ResourceSetInputProvider</code> filters to export only a
single input set per <code>ResourceSetInputProvider</code> object. If the number of permutations
exceeds <code>10000</code>, the operator will fail the reconciliation of the <code>ResourceSet</code> with
a <code>Stalled</code> condition.</p>
<p>When merging the input sets from each object, the <code>Permute</code> strategy places each input
set under a key that is the normalized name of the object providing the input set. The
normalization process is as follows:</p>
<ol>
<li>Uppercase letters are converted to lowercase.</li>
<li>Spaces and punctuation (including <code>-</code>) are converted to underscores (<code>_</code>).</li>
<li>All characters not in the set [a-z0-9_] are removed.</li>
<li>The remaining string is split by underscores and the resulting non-empty words are rejoined with underscores.</li>
</ol>
<p>The name normalization applied by the <code>Permute</code> strategy ensures that the resulting key is
compatible with the templating engine used in the resources templates.</p>
<p>Example of the <code>Permute</code> strategy with two <code>ResourceSetInputProvider</code> objects,
one selecting a single Git tag and the other selecting a single OCI tag:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluxcd.controlplane.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-rset</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Permute</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id1</span>
<span class="w">      </span><span class="nt">someField</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id2</span>
<span class="w">      </span><span class="nt">someField</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">  </span><span class="nt">inputsFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSetInputProvider</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git-tag</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSetInputProvider</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oci-tag</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cm-&lt;&lt; inputs.id &gt;&gt;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">data</span><span class="p">:</span>
<span class="w">        </span><span class="nt">rsetID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.my_rset.id | quote &gt;&gt;</span>
<span class="w">        </span><span class="nt">rsipGitID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.git_tag.id | quote &gt;&gt;</span>
<span class="w">        </span><span class="nt">rsipOCIID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.oci_tag.id | quote &gt;&gt;</span>
<span class="w">        </span><span class="nt">someField</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.my_rset.someField | quote &gt;&gt;</span>
<span class="w">        </span><span class="nt">sha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.git_tag.sha | quote &gt;&gt;</span>
<span class="w">        </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.oci_tag.digest | quote &gt;&gt;</span>
</code></pre></div>
<p>In the example above, the resulting input sets are similar to the following:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;768965678&quot;</span>
<span class="w">  </span><span class="nt">my_rset</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id1</span>
<span class="w">    </span><span class="nt">someField</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">  </span><span class="nt">git_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8765674567&quot;</span>
<span class="w">    </span><span class="nt">sha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bf5d6e01cf802734853f6f3417b237e3ad0ba35d</span>
<span class="w">  </span><span class="nt">oci_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9876543210&quot;</span>
<span class="w">    </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:d4ec9861522d4961b2acac5a070ef4f92d732480dff2062c2f3a1dcf9a5d1e91</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;234567654&quot;</span>
<span class="w">  </span><span class="nt">my_rset</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">id2</span>
<span class="w">    </span><span class="nt">someField</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">  </span><span class="nt">git_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8765674567&quot;</span>
<span class="w">    </span><span class="nt">sha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bf5d6e01cf802734853f6f3417b237e3ad0ba35d</span>
<span class="w">  </span><span class="nt">oci_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9876543210&quot;</span>
<span class="w">    </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:d4ec9861522d4961b2acac5a070ef4f92d732480dff2062c2f3a1dcf9a5d1e91</span>
</code></pre></div>
<p>This will generate two <code>ConfigMap</code> resources, one whose name will be <code>my-cm-768965678</code>,
and the other <code>my-cm-234567654</code>, each containing the rendered <code>.data</code> according to the
input set.</p>
<h3 id="resources-configuration">Resources configuration</h3>
<p>The <code>.spec.resources</code> field is optional and specifies the list of Kubernetes resource
to be generated and reconciled on the cluster.</p>
<p>The resources can be templated using the <code>&lt;&lt; inputs.name &gt;&gt;</code> syntax. The templating engine
is based on Go text template. The <code>&lt;&lt;  &gt;&gt;</code> delimiters are used instead of <code>{{  }}</code> to avoid
conflicts with Helm templating and allow ResourceSets to be included in Helm charts.</p>
<p>Example of templated resources:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team1</span>
<span class="w">      </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team2</span>
<span class="w">      </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">      </span><span class="nt">subjects</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux</span>
<span class="w">          </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">          </span><span class="nt">roleRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.role &gt;&gt;</span>
<span class="w">            </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>
<p>The above example will generate a <code>Namespace</code>, <code>ServiceAccount</code> and <code>RoleBinding</code> for each tenant
with the specified role.</p>
<h4 id="templating-functions">Templating functions</h4>
<p>The templating engine supports <a href="https://go-task.github.io/slim-sprig/">slim-sprig</a> functions.</p>
<p>It is recommended to use the <code>quote</code> function when templating strings to avoid issues with
special characters e.g. <code>&lt;&lt; inputs.version | quote &gt;&gt;</code>.</p>
<p>When templating integers, use the <code>int</code> function to convert the string to an integer
e.g. <code>&lt;&lt; inputs.replicas | int &gt;&gt;</code>.</p>
<p>When using integer or boolean inputs as metadata label values, use the <code>quote</code> function to convert
the value to a string e.g. <code>&lt;&lt; inputs.enabled | quote &gt;&gt;</code>.</p>
<p>When templating nested fields, use the <code>toYaml</code>  and <code>nindent</code> functions
to properly format the string e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team1</span>
<span class="w">      </span><span class="nt">layerSelector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">mediaType</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;application/vnd.cncf.helm.chart.content.v1.tar+gzip&quot;</span>
<span class="w">        </span><span class="nt">operation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">copy</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">layerSelector</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.layerSelector | toYaml | nindent 4 &gt;&gt;</span>
</code></pre></div>
<p>To assign a default value when an input field is not specified, use <code>get</code> combined with <code>default</code>.
E.g. using the namespace input as a default value for name:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team1</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; get inputs &quot;name&quot; | default inputs.namespace &gt;&gt;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.namespace &gt;&gt;</span>
</code></pre></div>
<p>In addition to the slim-sprig functions, a <code>slugify</code> function is available to normalize a string for use in a Kubernetes
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set">label value</a>
e.g. <code>&lt;&lt; inputs.tenant | slugify &gt;&gt;</code>.</p>
<h4 id="resource-deduplication">Resource deduplication</h4>
<p>The flux-operator deduplicates resources based on the
<code>apiVersion</code>, <code>kind</code>, <code>metadata.name</code> and <code>metadata.namespace</code> fields.</p>
<p>This allows defining shared resources that are applied only once, regardless of the number of inputs.</p>
<p>Example of a shared Flux source:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team2&quot;</span>
<span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.toolkit.fluxcd.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oci://ghcr.io/stefanprodan/charts/podinfo</span>
<span class="w">        </span><span class="nt">ref</span><span class="p">:</span>
<span class="w">          </span><span class="nt">semver</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm.toolkit.fluxcd.io/v2</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HelmRelease</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1h</span>
<span class="w">        </span><span class="nt">releaseName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo-&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">chartRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OCIRepository</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">        </span><span class="nt">values</span><span class="p">:</span>
<span class="w">          </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.replicas | int &gt;&gt;</span>
</code></pre></div>
<p>In the above example, the <code>OCIRepository</code> resource is created only once
and referred by all <code>HelmRelease</code> resources.</p>
<h4 id="copying-data-from-existing-configmaps-and-secrets">Copying data from existing ConfigMaps and Secrets</h4>
<p>To generate resources with data copied from existing ConfigMaps and Secrets,
the <code>fluxcd.controlplane.io/copyFrom: namespace/name</code> annotation must be
set in the ConfigMap or Secret template.</p>
<p>Example of copying data from an existing ConfigMap and Secret:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team2&quot;</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">runtime-info</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fluxcd.controlplane.io/copyFrom</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;flux-system/runtime-info&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker-auth</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fluxcd.controlplane.io/copyFrom</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;flux-system/docker-auth&quot;</span>
</code></pre></div>
<p>In the above example, a ConfigMap and a Secret are generated for each tenant
with the data copied from the <code>runtime-info</code> and <code>docker-auth</code> ConfigMap and Secret
from the <code>flux-system</code> namespace. If the source data changes, the operator will
update the generated resources accordingly on the next
<a href="#reconciliation-configuration">reconciliation interval</a>.</p>
<p>Note that on <a href="#role-based-access-control">multi-tenant clusters</a>, the service account
used by the ResourceSet must have the necessary permissions to read the ConfigMaps
and Secrets from the source namespace.</p>
<p>To trigger a reconciliation of the ResourceSet when changes occur in
the source ConfigMap or Secret, you can set the following label on the
source ConfigMap or Secret:</p>
<div class="highlight"><pre><span></span><code><span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reconcile.fluxcd.io/watch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enabled</span>
</code></pre></div>
<p>Note that neither this label nor any other metadata is copied to the generated
ConfigMaps and Secrets, you must label every ConfigMap or Secret that you want
to watch for changes.</p>
<p>An alternative to labeling every ConfigMap or Secret is
setting the <code>--watch-configs-label-selector=owner!=helm</code>
flag in flux-operator, which allows watching all ConfigMaps
and Secrets except for Helm storage Secrets.</p>
<h4 id="conditional-resource-exclusion">Conditional resource exclusion</h4>
<p>To exclude a resource based on input values, the <code>fluxcd.controlplane.io/reconcile</code> annotation can be set
to <code>disabled</code> on the resource metadata. This will prevent the resource from being reconciled by the operator.</p>
<p>Example of excluding a resource based on an input value:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team1&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;team2&quot;</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; inputs.tenant &gt;&gt;</span>
<span class="w">        </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fluxcd.controlplane.io/reconcile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;&lt; if eq inputs.tenant &quot;team1&quot; &gt;&gt;enabled&lt;&lt; else &gt;&gt;disabled&lt;&lt; end &gt;&gt;</span>
</code></pre></div>
<p>In the above example, the <code>ServiceAccount</code> resource is generated only for the <code>team1</code> tenant.</p>
<h4 id="built-in-input-fields">Built-in input fields</h4>
<p>When computing all the input sets for generating the resource matrix, the operator
adds a few built-in fields to each input set. Users cannot override these fields.</p>
<p>Every input set contains a built-in <code>inputs.id</code> field that is a unique identifier
for the input set amongst all the input sets generated for the ResourceSet. This
field can be used in the resource templates to generate unique resource names.</p>
<p>Every input set also contains the reference of the object providing those inputs:</p>
<ul>
<li><code>inputs.provider.apiVersion</code>: The API version of the object providing the inputs.</li>
<li><code>inputs.provider.kind</code>: The kind of the object providing the inputs.</li>
<li><code>inputs.provider.name</code>: The name of the object providing the inputs.</li>
<li><code>inputs.provider.namespace</code>: The namespace of the object providing the inputs.</li>
</ul>
<p>In the case of inline inputs provided directly in the <code>ResourceSet</code> object through the
<code>.spec.inputs</code> field, <code>inputs.provider.apiVersion</code> is <code>fluxcd.controlplane.io/v1</code> and
<code>inputs.provider.kind</code> is <code>ResourceSet</code>.</p>
<p>In the case of inputs provided through a <code>ResourceSetInputProvider</code> referenced in the
<code>.spec.inputsFrom</code> field of a <code>ResourceSet</code>, <code>inputs.provider.apiVersion</code> is
<code>fluxcd.controlplane.io/v1</code> and <code>inputs.provider.kind</code> is <code>ResourceSetInputProvider</code>.</p>
<p>If the <code>.spec.inputStrategy.name</code> <a href="#input-strategy">field</a> is set to <code>Permute</code>, the
built-in fields above are nested under a key that is the normalized name of the object
providing the inputs, i.e.:</p>
<ul>
<li><code>inputs.&lt;normalized object name&gt;.id</code></li>
<li><code>inputs.&lt;normalized object name&gt;.provider.apiVersion</code></li>
<li><code>inputs.&lt;normalized object name&gt;.provider.kind</code></li>
<li><code>inputs.&lt;normalized object name&gt;.provider.name</code></li>
<li><code>inputs.&lt;normalized object name&gt;.provider.namespace</code></li>
</ul>
<p>And <code>inputs.id</code> will be derived from the permutation configuration, making each
permutation have a unique ID.</p>
<h3 id="resources-template">Resources template</h3>
<p>The <code>.spec.resourcesTemplate</code> field is optional and offers an alternative to the <code>.spec.resources</code>.
The <code>.spec.resourcesTemplate</code> is a single string that contains the multi-document YAML of the resources
definitions. This field can be used for complex templating scenarios with the trade-off of reduced readability.</p>
<p>Note that when both <code>.spec.resources</code> and <code>.spec.resourcesTemplate</code> are set, the resulting resources
are the union of the two. If duplicate resources are defined in both fields, the resources from
<code>.spec.resources</code> take precedence.</p>
<p>Example of a template containing conditional and repeated blocks:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bundle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">addons</span>
<span class="w">      </span><span class="nt">decryption</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">components</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bundle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps</span>
<span class="w">      </span><span class="nt">decryption</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">components</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class="w">  </span><span class="nt">resourcesTemplate</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">---</span>
<span class="w">    </span><span class="no">apiVersion: source.toolkit.fluxcd.io/v1</span>
<span class="w">    </span><span class="no">kind: OCIRepository</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: &lt;&lt; inputs.bundle &gt;&gt;</span>
<span class="w">      </span><span class="no">namespace: flux-system</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">interval: 10m</span>
<span class="w">      </span><span class="no">url: oci://registry.example.com/&lt;&lt; inputs.bundle &gt;&gt;</span>
<span class="w">    </span><span class="no">&lt;&lt;- range $component := inputs.components &gt;&gt;</span>
<span class="w">    </span><span class="no">---</span>
<span class="w">    </span><span class="no">apiVersion: kustomize.toolkit.fluxcd.io/v1</span>
<span class="w">    </span><span class="no">kind: Kustomization</span>
<span class="w">    </span><span class="no">metadata:</span>
<span class="w">      </span><span class="no">name: &lt;&lt; $component &gt;&gt;</span>
<span class="w">      </span><span class="no">namespace: flux-system</span>
<span class="w">    </span><span class="no">spec:</span>
<span class="w">      </span><span class="no">interval: 1h</span>
<span class="w">      </span><span class="no">prune: true</span>
<span class="w">      </span><span class="no">&lt;&lt;- if inputs.decryption &gt;&gt;</span>
<span class="w">      </span><span class="no">decryption:</span>
<span class="w">        </span><span class="no">provider: sops</span>
<span class="w">        </span><span class="no">secretRef:</span>
<span class="w">          </span><span class="no">name: &lt;&lt; inputs.bundle &gt;&gt;-sops</span>
<span class="w">      </span><span class="no">&lt;&lt;- end &gt;&gt;</span>
<span class="w">      </span><span class="no">sourceRef:</span>
<span class="w">        </span><span class="no">kind: OCIRepository</span>
<span class="w">        </span><span class="no">name: &lt;&lt; inputs.bundle &gt;&gt;</span>
<span class="w">      </span><span class="no">path: ./&lt;&lt; $component &gt;&gt;</span>
<span class="w">    </span><span class="no">&lt;&lt;- end &gt;&gt;</span>
</code></pre></div>
<p>The above example generates two <code>OCIRepository</code> resources (one for each bundle) and four
<code>Kustomization</code> resources (one for each component in each bundle).</p>
<h3 id="common-metadata">Common metadata</h3>
<p>The <code>.spec.commonMetadata</code> field is optional and specifies common metadata to be applied to all resources.</p>
<p>It has two optional fields:</p>
<ul>
<li><code>labels</code>: A map used for setting <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">labels</a>
  on an object. Any existing label will be overridden if it matches with a key in
  this map.</li>
<li><code>annotations</code>: A map used for setting <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">annotations</a>
  on an object. Any existing annotation will be overridden if it matches with a key
  in this map.</li>
</ul>
<p>Example common metadata:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">commonMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">podinfo</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fluxcd.controlplane.io/prune</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disabled</span>
</code></pre></div>
<p>In the above example, all resources generated by the ResourceSet
will not be pruned by the <a href="#garbage-collection">garbage collection</a> process as
the <code>fluxcd.controlplane.io/prune</code> annotation is set to <code>disabled</code>.</p>
<h3 id="dependency-management">Dependency management</h3>
<p><code>.spec.dependsOn</code> is an optional list used to refer to Kubernetes
objects that the ResourceSet depends on. If specified, then the ResourceSet
is reconciled after the referred objects exist in the cluster.</p>
<p>A dependency is a reference to a Kubernetes object with the following fields:</p>
<ul>
<li><code>apiVersion</code>: The API version of the referred object (required).</li>
<li><code>kind</code>: The kind of the referred object (required).</li>
<li><code>name</code>: The name of the referred object (required).</li>
<li><code>namespace</code>: The namespace of the referred object (optional).</li>
<li><code>ready</code>: A boolean indicating if the referred object must have the <code>Ready</code> status condition set to <code>True</code> (optional, default is <code>false</code>).</li>
<li><code>readyExpr</code>: A <a href="#cel-readiness-expressions">CEL expression</a> that evaluates to a boolean indicating if the referred object is ready (optional).</li>
</ul>
<p>Example of conditional reconciliation based on the existence of CustomResourceDefinitions
and the readiness of a ResourceSet:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dependsOn</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.k8s.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CustomResourceDefinition</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helmreleases.helm.toolkit.fluxcd.io</span>
<span class="w">      </span><span class="nt">ready</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.k8s.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CustomResourceDefinition</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">servicemonitors.monitoring.coreos.com</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluxcd.controlplane.io/v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ResourceSet</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-addons</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-system</span>
<span class="w">      </span><span class="nt">ready</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Note that is recommended to define dependencies on CustomResourceDefinitions if the ResourceSet
deploys Flux HelmReleases which contain custom resources.</p>
<p>When the dependencies are not met, the flux-operator will reevaluate the requirements
every five seconds and reconcile the ResourceSet when the dependencies are satisfied.
Failed dependencies are reported in the ResourceSet <code>Ready</code> <a href="#ResourceSet-Status">status condition</a>,
in log messages and Kubernetes events.</p>
<h4 id="cel-readiness-expressions">CEL readiness expressions</h4>
<p>The <code>readyExpr</code> field allows for more complex readiness checks and
can be used for gating the reconciliation of a ResourceSet based on the evaluation
of the <a href="https://cel.dev">CEL</a> expression.</p>
<p>The expression is evaluated in the context of the referred object and has access to all the fields of the object,
including the status conditions and the status subfields. The expression must evaluate to a boolean value, any syntax
or runtime errors will be reported in the ResourceSet status conditions.</p>
<p>Example readiness expression:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dependsOn</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cluster</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">      </span><span class="nt">ready</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">readyExpr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">metadata.generation == status.observedGeneration &amp;&amp;</span>
<span class="w">        </span><span class="no">status.controlPlaneReady == true</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-gate</span>
<span class="w">      </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<span class="w">      </span><span class="nt">ready</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">readyExpr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">string(base64.decode(data.gate)) == &#39;opened&#39;</span>
</code></pre></div>
<p>For testing the CEL expressions, you can use the <a href="https://playcel.undistro.io/">CEL playground</a>.</p>
<h3 id="reconciliation-configuration">Reconciliation configuration</h3>
<p>The reconciliation behavior of a ResourceSet can be configured using the following annotations:</p>
<ul>
<li><code>fluxcd.controlplane.io/reconcile</code>:
  Enable or disable the reconciliation loop. Default is <code>enabled</code>, set to <code>disabled</code> to pause the reconciliation.</li>
<li><code>fluxcd.controlplane.io/reconcileEvery</code>:
  Set the reconciliation interval used for drift detection and correction. Default is <code>1h</code>.</li>
<li><code>fluxcd.controlplane.io/reconcileTimeout</code>:
  Set the reconciliation timeout including health checks. Default is <code>5m</code>.</li>
<li><code>fluxcd.controlplane.io/force</code>:
  When set to <code>enabled</code>, the controller will replace the generated resources that contain immutable field changes.
  This annotation can also be used on individual resources to force their reconciliation.</li>
</ul>
<h3 id="health-check-configuration">Health check configuration</h3>
<p>The <code>.spec.wait</code> field is optional and instructs the flux-operator to perform
a health check on all applied resources and waits for them to become ready. The health
check is disabled by default and can be enabled by setting the <code>.spec.wait</code> field to <code>true</code>.</p>
<p>The health check is performed for the following resources types:</p>
<ul>
<li>Kubernetes built-in kinds: Deployment, DaemonSet, StatefulSet,
  PersistentVolumeClaim, Service, Ingress, CustomResourceDefinition.</li>
<li>Flux kinds: HelmRelease, OCIRepository, Kustomization, GitRepository, etc.</li>
<li>Custom resources that are compatible with <a href="https://github.com/kubernetes-sigs/cli-utils/tree/master/pkg/kstatus">kstatus</a>.</li>
</ul>
<p>By default, the wait timeout is <code>5m</code> and can be changed with the
<code>fluxcd.controlplane.io/reconcileTimeout</code> annotation, set on the ResourceSet object.</p>
<h3 id="role-based-access-control">Role-based access control</h3>
<p>The <code>.spec.serviceAccountName</code> field is optional and specifies the name of the
Kubernetes ServiceAccount used by the flux-operator to reconcile the ResourceSet.
The ServiceAccount must exist in the same namespace as the ResourceSet
and must have the necessary permissions to create, update and delete
the resources defined in the ResourceSet.</p>
<p>On multi-tenant clusters, it is recommended to use a dedicated ServiceAccount per tenant namespace
with the minimum required permissions. To enforce a ServiceAccount for all ResourceSets,
the <code>--default-service-account=flux-operator</code> flag can be set in the flux-operator container arguments.
With this flag set, only the ResourceSets created in the same namespace as the flux-operator
will run with cluster-admin permissions.</p>
<p>When installing the Flux Operator with Helm, you can change the default service account name with:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>flux-operator<span class="w"> </span>oci://ghcr.io/controlplaneio-fluxcd/charts/flux-operator<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>flux-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>multitenancy.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>multitenancy.defaultServiceAccount<span class="o">=</span>flux-operator
</code></pre></div>
<p>When installing the Flux Operator on OpenShift from OperatorHub, the default service account name
can be changed by setting the <code>DEFAULT_SERVICE_ACCOUNT</code> environment variable using the OLM
<a href="https://github.com/operator-framework/operator-lifecycle-manager/blob/master/doc/design/subscription-config.md">Subscription</a>
<code>.spec.config.env</code> field.</p>
<h3 id="garbage-collection">Garbage collection</h3>
<p>The operator performs garbage collection of the resources previously generated by a ResourceSet
that are no longer present in the current revision. Garbage collection is also performed
when a ResourceSet object is deleted, triggering a removal of all Kubernetes
objects previously applied on the cluster.</p>
<p>The garbage collection process removes stale resources in stages, first it deletes the Flux
custom resources and waits for the Flux Kustomizations and HelmReleases to be finalized by
the controllers. After the Flux resources are removed (max wait is one minute), the operator
proceeds with the deletion of the remaining Kubernetes objects. This ensures that the
Flux controllers have a chance to clean up the resources they manage before the operator
deletes the Kubernetes ServiceAccount and RoleBinding used by Flux impersonation.</p>
<p>After the garbage collection process is completed, the operator issues a Kubernetes event
containing the list of removed resources and the duration of the cleanup.</p>
<p>The garbage collection is enabled by default and can be disabled for certain resources
by setting the <code>fluxcd.controlplane.io/prune</code> annotation to <code>disabled</code>. To fully disable
the garbage collection for a ResourceSet, the annotation must be set on all resources
using the <a href="#common-metadata"><code>.spec.commonMetadata</code></a> field.</p>
<h2 id="resourceset-status">ResourceSet Status</h2>
<h3 id="conditions">Conditions</h3>
<p>A ResourceSet enters various states during its lifecycle, reflected as Kubernetes Conditions.
It can be <a href="#reconciling-resourceset">reconciling</a> while applying the resources on the cluster,
it can be <a href="#ready-resourceset">ready</a>,
it can <a href="#failed-resourceset">fail during reconciliation</a>,
or it can <a href="#stalled-resourceset">fail due to misconfiguration</a>.</p>
<p>The ResourceSet API is compatible with the <strong>kstatus</strong> specification,
and reports <code>Reconciling</code> and <code>Stalled</code> conditions where applicable to
provide better (timeout) support to solutions polling the ResourceSet to
become <code>Ready</code>.</p>
<h4 id="reconciling-resourceset">Reconciling ResourceSet</h4>
<p>The flux-operator marks a ResourceSet as <em>reconciling</em> when it starts
the reconciliation of the same. The Condition added to the ResourceSet's
<code>.status.conditions</code> has the following attributes:</p>
<ul>
<li><code>type: Reconciling</code></li>
<li><code>status: "True"</code></li>
<li><code>reason: Progressing</code> | <code>reason: ProgressingWithRetry</code></li>
</ul>
<p>The Condition <code>message</code> is updated during the course of the reconciliation to
report the action being performed at any particular moment such as
building manifests, detecting drift, etc.</p>
<p>The <code>Ready</code> Condition's <code>status</code> is also marked as <code>Unknown</code>.</p>
<h4 id="ready-resourceset">Ready ResourceSet</h4>
<p>The flux-operator marks a ResourceSet as <em>ready</em> when the resources were
built and applied on the cluster and all health checks are observed to be passing.</p>
<p>When the ResourceSet is "ready", the flux-operator sets a Condition with the
following attributes in the ResourceSet’s <code>.status.conditions</code>:</p>
<ul>
<li><code>type: Ready</code></li>
<li><code>status: "True"</code></li>
<li><code>reason: ReconciliationSucceeded</code></li>
</ul>
<h4 id="failed-resourceset">Failed ResourceSet</h4>
<p>The flux-operator may get stuck trying to reconcile and apply a
ResourceSet without completing. This can occur due to some of the following factors:</p>
<ul>
<li>The dependencies are not ready.</li>
<li>The templating of the resources fails.</li>
<li>The resources are invalid and cannot be applied.</li>
<li>Garbage collection fails.</li>
<li>Running health checks fails.</li>
</ul>
<p>When this happens, the flux-operator sets the <code>Ready</code> Condition status to False
and adds a Condition with the following attributes to the ResourceSet’s
<code>.status.conditions</code>:</p>
<ul>
<li><code>type: Ready</code></li>
<li><code>status: "False"</code></li>
<li><code>reason: DependencyNotReady | BuildFailed | ReconciliationFailed | HealthCheckFailed</code></li>
</ul>
<p>The <code>message</code> field of the Condition will contain more information about why
the reconciliation failed.</p>
<p>While the ResourceSet has one or more of these Conditions, the flux-operator
will continue to attempt a reconciliation with an
exponential backoff, until it succeeds and the ResourceSet is marked as <a href="#ready-resourceset">ready</a>.</p>
<h4 id="stalled-resourceset">Stalled ResourceSet</h4>
<p>The flux-operator may fail the reconciliation of a ResourceSet object terminally due
to a misconfiguration. When this happens, the flux-operator adds the <code>Stalled</code> Condition
to the ResourceSet’s <code>.status.conditions</code> with the following attributes:</p>
<ul>
<li><code>type: Stalled</code></li>
<li><code>status: "True"</code></li>
<li><code>reason: InvalidCELExpression | BuildFailed</code></li>
</ul>
<p>Misconfigurations can include:</p>
<ul>
<li>The <code>.spec.dependsOn[].readyExpr</code> expression is invalid. In this case the condition reason is
<code>InvalidCELExpression</code>.</li>
<li>The templating of the resources fails. In this case the condition reason is <code>BuildFailed</code>.</li>
</ul>
<p>When this happens, the flux-operator will not attempt to reconcile the ResourceSet
until the misconfiguration is fixed. The <code>Ready</code> Condition status is also set to <code>False</code>.</p>
<h3 id="history">History</h3>
<p>With <code>.status.history</code> the operator tracks the reconciliation attempts over time, providing insights
into the ResourceSet's behavior which can be used for audit, anomaly detection and debugging purposes.</p>
<p>The history is stored as a list of snapshots, ordered by last reconciliation time. Each snapshot contains:</p>
<ul>
<li><code>digest</code>: A SHA256 digest that uniquely identifies the set of generated resources being reconciled</li>
<li><code>firstReconciled</code>: The timestamp when this particular configuration was first reconciled</li>
<li><code>lastReconciled</code>: The timestamp of the most recent reconciliation attempt for this configuration</li>
<li><code>lastReconciledDuration</code>: How long the most recent reconciliation attempt took</li>
<li><code>lastReconciledStatus</code>: The status of the most recent reconciliation (e.g., <code>ReconciliationSucceeded</code>, <code>BuildFailed</code>, <code>ReconciliationFailed</code>)</li>
<li><code>totalReconciliations</code>: The total number of reconciliations for this configuration</li>
<li><code>metadata</code>: Additional information about the reconciliation, including the number of generated resources and inputs processed</li>
</ul>
<p>The operator deduplicates entries based on the digest and status.
The history is automatically truncated to keep only the 5 most recent entries.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="nt">history</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:43ad78c94b2655429d84f21488f29d7cca9cd45b7f54d2b27e16bbec8eff9228</span>
<span class="w">      </span><span class="nt">firstReconciled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-07-15T10:11:00Z&quot;</span>
<span class="w">      </span><span class="nt">lastReconciled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-07-15T14:30:00Z&quot;</span>
<span class="w">      </span><span class="nt">lastReconciledDuration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.818583s</span>
<span class="w">      </span><span class="nt">lastReconciledStatus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReconciliationSucceeded</span>
<span class="w">      </span><span class="nt">totalReconciliations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">digest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sha256:ec8dbfe61777b65001190260cf873ffe454451bd2e464bd6f9a154cffcdcd7e5</span>
<span class="w">      </span><span class="nt">firstReconciled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-07-14T13:10:00Z&quot;</span>
<span class="w">      </span><span class="nt">lastReconciled</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-07-15T10:10:00Z&quot;</span>
<span class="w">      </span><span class="nt">lastReconciledDuration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.813292s</span>
<span class="w">      </span><span class="nt">lastReconciledStatus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReconciliationFailed</span>
<span class="w">      </span><span class="nt">totalReconciliations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
<span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
</code></pre></div>
<p>Note that for <code>BuildFailed</code> errors, the digest is calculated from the resource templates, as the final resources
are not available.</p>
<h3 id="inventory">Inventory</h3>
<p>In order to perform operations such as drift detection, garbage collection, upgrades, etc.,
the flux-operator needs to keep track of all Kubernetes objects that are
reconciled as part of a ResourceSet. To do this, it maintains an inventory
containing the list of Kubernetes resource object references that have been
successfully applied and records it in <code>.status.inventory</code>. The inventory
records are in the format <code>Id: &lt;namespace&gt;_&lt;name&gt;_&lt;group&gt;_&lt;kind&gt;, V: &lt;version&gt;</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="nt">inventory</span><span class="p">:</span>
<span class="w">    </span><span class="nt">entries</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps_podinfo_helm.toolkit.fluxcd.io_HelmRelease</span>
<span class="w">        </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps_podinfo_source.toolkit.fluxcd.io_OCIRepository</span>
<span class="w">        </span><span class="nt">v</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</code></pre></div>
<h2 id="resourceset-metrics">ResourceSet Metrics</h2>
<p>The Flux Operator exports Prometheus metrics for the ResourceSet objects
that can be used to monitor the reconciliation status.</p>
<p>Metrics:</p>
<div class="highlight"><pre><span></span><code>flux_resourceset_info{uid, kind, name, exported_namespace, ready, suspended, revision}
</code></pre></div>
<p>Labels:</p>
<ul>
<li><code>uid</code>: The Kubernetes unique identifier of the resource.</li>
<li><code>kind</code>: The kind of the resource (e.g. <code>ResourceSet</code>).</li>
<li><code>name</code>: The name of the resource (e.g. <code>podinfo</code>).</li>
<li><code>exported_namespace</code>: The namespace where the resource is deployed (e.g. <code>apps</code>).</li>
<li><code>ready</code>: The readiness status of the resource (e.g. <code>True</code>, <code>False</code> or <code>Unkown</code>).</li>
<li><code>reason</code>: The reason for the readiness status (e.g. <code>ReconciliationSucceeded</code>, <code>BuildFailed</code>, <code>HealthCheckFailed</code>, etc.).</li>
<li><code>suspended</code>: The suspended status of the resource (e.g. <code>True</code> or <code>False</code>).</li>
<li><code>resources</code>: The number of resources generated by the ResourceSet.</li>
<li><code>revision</code>: The revision last applied on the cluster (e.g. <code>sha256:75aa209c6a...</code>).</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025 ControlPlane Ltd.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://x.com/controlplaneio" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h320c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm297.1 84L257.3 234.6 379.4 396h-95.6L209 298.1 123.3 396H75.8l111-126.9L69.7 116h98l67.7 89.5 78.2-89.5zm-37.8 251.6L153.4 142.9h-28.3l171.8 224.7z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/controlplane/mycompany/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.sections", "navigation.top", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>